<div class="cat-index-container">
  <div class="form">
    <%= form_with url: cats_path, method: :get, class: "d-flex" do %>
      <%= text_field_tag :query,
        params[:query],
        class: "form-control",
        placeholder: "Browse cats by city",
        autocomplete: "off"
      %>
      <%= button_tag type: 'submit', class: 'btn btn-primary' do %><i class="fa-solid fa-magnifying-glass"></i><% end %>
    <% end %>
  </div>
  <%= link_to map_cats_path, class: 'btn btn-primary' do %><i class= "fa-solid fa-map"></i><% end %>
  <div class="cat-card" data-controller="match">
    <% if @cats.any? %>
      <% @cats.each_with_index do |cat, index| %>
        <div data-match-target="next" id="<%=index%>" class="container mb-5 <%= index.zero? ? '' : 'd-none' %>">
          <div class="cat-card-title">
            <h2><%= cat.name %></h2>
          </div>
          <div class="cat-card-image">
            <div id="carouselExampleControls<%=index%>" class="carousel slide">
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <% if cat.img_1.attached? %>
                    <%= cl_image_tag(cat.img_1.key, height: 350, width: 350, crop: "fill")%>
                  <% end %>
                </div>
                <div class="carousel-item">
                  <% if cat.img_2.attached? %>
                    <%= cl_image_tag(cat.img_2.key, height: 350, width: 350, crop: "fill")%>
                  <% end %>
                </div>
                <div class="carousel-item">
                  <% if cat.img_3.attached? %>
                    <%= cl_image_tag(cat.img_3.key, height: 350, width: 350, crop: "fill")%>
                  <% end %>
                </div>
                <div class="cat-card-actions">
                  <%= button_to cat_matches_path(cat), class: "btn-heart", data: {turbo_method: :post} do %>
                    <i class="fa-solid fa-paw"></i>
                  <% end %>
                  <button class="btn-trash"><i  data-action="click->match#next"  data-id="<%=index%>" class="fa-solid fa-xmark"></i></button>
                </div>
              </div>
              <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls<%=index%>" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls<%=index%>" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
          </div>
          <div class="cat-card-details">
            <p><%= cat.personality%><br/>
            <hr>
            Breed: <%= cat.breed %><br/>
            Age: <%= cat.age %>
            <%if cat.ratings.average(:rating) != nil %>
              <% average_rating_floor = cat.ratings.average(:rating).to_i %>
              <% average_rating_decimal = cat.ratings.average(:rating) - average_rating_floor %>
              <% 5.times do |index| %>
                <% if index < average_rating_floor %>
                  <i class="fas fa-star" style="color: #FFD43B;"></i>
                <% elsif index == average_rating_floor && average_rating_decimal > 0 %>
                  <i class="fas fa-star-half" style="color: #FFD43B;"></i>
                <% else %>
                  <i class="far fa-star" style="color: white;"></i>
                <% end %>
              <% end %>
            <% end %>
              <% unless cat.ratings.average(:rating).nil? %>
                <% rating = cat.ratings.average(:rating) %>
                <p>Rated: <span><%= rating.round(1) %></span> from <span><%= cat.ratings.count %></span> reviews</p>
              <% else %>
                <p>Not rated yet</p>
              <% end %>
          </div>
        </div>
      <% end %>
    <% else %>
      <p>Sorry, no cats found. Try another city or look directly at the map.</p>
       <img src="/images/404.jpg" width="300" />
    <%end%>
    </div>
  </div>
</div>
